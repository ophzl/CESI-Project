@model web.Models.ProductViewModel

@{
    ViewData["Title"] = "Liste des vins";
}

<link rel="stylesheet" href="~/css/home.css" />

<h1>Liste des vins</h1>

<form asp-controller="Products" asp-action="Index" method="get">
    <p>
        <select name="house" asp-for="ProductHouse" asp-items="Model.Houses">
            <option value="">Toutes</option>
        </select>
        <select name="year" asp-for="ProductYear" asp-items="Model.Years">
            <option value="">Toutes</option>
        </select>
        <select name="family" asp-for="ProductFamily" asp-items="Model.Families">
            <option value="">Toutes</option>
        </select>
        <input type="submit" value="Filtrer" />
    </p>
</form>

<table class="table">
    <tbody>
        @foreach (var item in Model.Products)
        {
        <tr>
            <td>
                @Html.DisplayFor(modelItem => item.Name)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.WineFamily)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.SellPrice)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.House)
            </td>
            <td>
                <button onclick="setProductToCart(@item.Id)">Add to cart</button>
            </td>
        </tr>
        }
    </tbody>
</table>

<script>
    function setProductToCart(product_id) {
        var str_product_id = '' + product_id
        if (!localStorage.getItem(str_product_id)) {
            localStorage.setItem(str_product_id, 1)
        } else {
            var str_quantity = localStorage.getItem(str_product_id);
            var final_quantity = parseInt(str_quantity, 10) + 1
            var str_final_quantity = '' + final_quantity
            localStorage.setItem(product_id, str_final_quantity)
            console.log(localStorage)
        }
    }
</script>
